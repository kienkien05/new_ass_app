<!DOCTYPE html>
<html class="dark" lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Danh sách Sự kiện - EViENT</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />

    <!-- Static CSS -->
    <link href="../../css/output.css" rel="stylesheet" />

    <!-- Shared Global Logic -->
    <script src="../../js/main.js"></script>
    <script src="../../js/event-utils.js"></script>
    <script src="../../js/api-connector.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        .dark ::-webkit-scrollbar-track {
            background: #101622;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #374151;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        /* ===== ICONS ===== */
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        .icon-fill {
            font-variation-settings:
                'FILL' 1,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        /* ===== UTILITIES ===== */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Active nav link style */
        .nav-link-active {
            color: #1C64F2 !important;
            font-weight: 700 !important;
            position: relative;
        }

        .nav-link-active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #1C64F2;
        }

        .dark .nav-link-active {
            color: #ffffff !important;
        }

        .dark .nav-link-active::after {
            background-color: #ffffff;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white transition-colors duration-200">
    <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">

        <!-- ===== HEADER ===== -->
        <header id="user-header"
            class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-[#27272a] bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md px-4 lg:px-10 py-3">
            <!-- Content loaded by JS -->
        </header>

        <!-- ===== MAIN CONTENT ===== -->
        <main class="flex-1 w-full mx-auto max-w-[1440px]">
            <div class="layout-container flex flex-col lg:flex-row h-full grow w-full"
                style="display: flex; flex-direction: row;">
                <!-- Sidebar Filters -->
                <aside class="w-full lg:w-[320px] flex-shrink-0 lg:mr-6" style="width: 320px; flex-shrink: 0;">
                    <div
                        class="sticky top-24 flex flex-col gap-6 p-6 rounded-2xl border border-gray-200 dark:border-zinc-800 bg-white dark:bg-surface-dark h-fit shadow-sm">
                        <!-- HeadlineText -->
                        <div
                            class="flex items-center justify-between pb-2 border-b border-gray-200 dark:border-[#27272a]">
                            <h3 class="text-slate-900 dark:text-white tracking-tight text-2xl font-bold leading-tight">
                                Bộ lọc</h3>
                            <button class="text-primary text-sm font-medium hover:underline">Đặt lại</button>
                        </div>
                        <!-- TextField: Keyword -->
                        <div class="flex flex-col gap-2">
                            <p class="text-slate-700 dark:text-white text-base font-medium leading-normal">Từ khóa</p>
                            <div class="relative w-full">
                                <input
                                    class="form-input w-full rounded-xl text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-gray-300 dark:border-[#3f3f46] bg-white dark:bg-[#18181b] focus:border-primary h-12 placeholder:text-gray-400 dark:placeholder:text-[#a1a1aa] pl-4 pr-12 text-base font-normal leading-normal"
                                    placeholder="Tên sự kiện..." value="" />
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none text-gray-400 dark:text-[#a1a1aa]">
                                    <span class="material-symbols-outlined">search</span>
                                </div>
                            </div>
                        </div>
                        <!-- TextField: Location Select -->
                        <div class="flex flex-col gap-2">
                            <p class="text-slate-700 dark:text-white text-base font-medium leading-normal">Địa điểm</p>
                            <div class="relative">
                                <select
                                    class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-gray-300 dark:border-[#3f3f46] bg-white dark:bg-[#18181b] focus:border-primary h-12 px-4 text-base font-normal leading-normal appearance-none cursor-pointer">
                                    <option disabled="" selected="" value="">Tất cả thành phố</option>
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-400 dark:text-[#a1a1aa]">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </div>
                            </div>
                        </div>
                        <!-- CalendarPicker -->
                        <p class="text-slate-700 dark:text-white text-base font-medium leading-normal">Thời gian</p>
                        <div class="flex flex-col gap-3">
                            <div class="grid grid-cols-2 gap-2 mt-1">
                                <div class="flex flex-col gap-1">
                                    <label class="text-[10px] uppercase font-bold text-gray-400">Từ ngày</label>
                                    <input type="date"
                                        class="w-full bg-white dark:bg-[#18181b] border border-gray-300 dark:border-[#3f3f46] text-slate-900 dark:text-white text-xs rounded-lg px-2 py-2 focus:ring-1 focus:ring-primary focus:border-primary"
                                        onchange="resetQuickFilters()">
                                </div>
                                <div class="flex flex-col gap-1">
                                    <label class="text-[10px] uppercase font-bold text-gray-400">Đến ngày</label>
                                    <input type="date"
                                        class="w-full bg-white dark:bg-[#18181b] border border-gray-300 dark:border-[#3f3f46] text-slate-900 dark:text-white text-xs rounded-lg px-2 py-2 focus:ring-1 focus:ring-primary focus:border-primary"
                                        onchange="resetQuickFilters()">
                                </div>
                            </div>
                        </div>

                        <script>
                            function selectDateFilter(btn) {
                                document.querySelectorAll('.filter-date-btn').forEach(b => {
                                    b.classList.remove('bg-primary', 'text-white', 'border-primary', 'active');
                                    b.classList.add('bg-white', 'dark:bg-[#18181b]', 'text-slate-600', 'dark:text-gray-400', 'border-gray-200', 'dark:border-gray-700');
                                });
                                btn.classList.remove('bg-white', 'dark:bg-[#18181b]', 'text-slate-600', 'dark:text-gray-400', 'border-gray-200', 'dark:border-gray-700');
                                btn.classList.add('bg-primary', 'text-white', 'border-primary', 'active');
                                document.querySelectorAll('input[type="date"]').forEach(input => input.value = '');
                            }

                            function resetQuickFilters() {
                                document.querySelectorAll('.filter-date-btn').forEach(b => {
                                    b.classList.remove('bg-primary', 'text-white', 'border-primary', 'active');
                                    b.classList.add('bg-white', 'dark:bg-[#18181b]', 'text-slate-600', 'dark:text-gray-400', 'border-gray-200', 'dark:border-gray-700');
                                });
                            }
                        </script>
                        <!-- Filter Actions -->
                        <button
                            class="flex w-full items-center justify-center rounded-xl h-12 bg-primary hover:bg-blue-700 text-white text-base font-bold leading-normal transition-all shadow-lg shadow-primary/20 mt-2">
                            Áp dụng
                        </button>
                    </div>
                </aside>
                <!-- Main Grid Area -->
                <main class="flex-1 p-6 lg:p-10">
                    <!-- Header & Sorting -->
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
                        <div>
                            <h1 class="text-slate-900 dark:text-white text-3xl font-bold leading-tight mb-2">Sự kiện sắp
                                diễn ra</h1>
                            <p class="text-gray-500 dark:text-[#a1a1aa] text-sm font-medium">Hiển thị 12 kết quả phù hợp
                                nhất</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-slate-700 dark:text-white text-sm font-medium whitespace-nowrap">Sắp xếp
                                theo:</span>
                            <div class="relative min-w-[160px]">
                                <select
                                    class="w-full bg-white dark:bg-[#18181b] border border-gray-300 dark:border-[#3f3f46] text-slate-900 dark:text-white text-sm rounded-lg px-3 py-2.5 focus:ring-primary focus:border-primary appearance-none cursor-pointer">
                                    <option>Mới nhất</option>
                                    <option>Sắp diễn ra</option>
                                    <option>Giá: Thấp đến Cao</option>
                                    <option>Giá: Cao đến Thấp</option>
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500 dark:text-[#a1a1aa]">
                                    <span class="material-symbols-outlined text-sm">expand_more</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Events Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Event list will be populated by API -->
                        <div
                            class="col-span-full flex flex-col items-center justify-center py-12 text-center text-gray-500 dark:text-gray-400">
                            <span class="material-symbols-outlined text-4xl mb-2">event_busy</span>
                            <p>Chưa có sự kiện nào.</p>
                        </div>
                    </div>
                    <!-- Pagination -->
                    <div id="load-more-container" class="hidden flex items-center justify-center mt-12 mb-8">
                        <button
                            class="flex items-center gap-2 rounded-full border border-gray-300 dark:border-[#3f3f46] bg-white dark:bg-[#18181b] px-8 py-3 text-sm font-bold text-slate-900 dark:text-white transition-all hover:bg-gray-100 dark:hover:bg-[#3f3f46] hover:shadow-lg">
                            Xem thêm sự kiện
                            <span class="material-symbols-outlined">arrow_downward</span>
                        </button>
                    </div>
                </main>
            </div>
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initUserPage('events', 'Sự kiện');
            // Initial check with 0 items or mock items if added
            updateLoadMoreVisibility();
            window.addEventListener('resize', updateLoadMoreVisibility);
        });

        const btnApplyFilter = document.querySelector('button.bg-primary.hover\\:bg-blue-700');
        if (btnApplyFilter) {
            btnApplyFilter.addEventListener('click', filterEvents);
        }

        function filterEvents() {
            const keywordInput = document.querySelector('input[placeholder="Tên sự kiện, nghệ sĩ..."]');
            const locationSelect = document.querySelector('select.form-select');

            const keyword = keywordInput ? keywordInput.value.toLowerCase().trim() : '';
            const location = locationSelect ? locationSelect.value : '';

            const cards = document.querySelectorAll('.event-card');
            let visibleCount = 0;

            cards.forEach(card => {
                const title = card.getAttribute('data-title').toLowerCase();
                const cardLoc = card.getAttribute('data-location');

                let matchesKeyword = true;
                let matchesLocation = true;

                if (keyword && !title.includes(keyword)) {
                    matchesKeyword = false;
                }

                if (location && cardLoc !== location) {
                    matchesLocation = false;
                }

                if (matchesKeyword && matchesLocation) {
                    card.classList.remove('hidden');
                    visibleCount++;
                } else {
                    card.classList.add('hidden');
                }
            });

            // Update button visibility after filtering
            updateLoadMoreVisibility(visibleCount);
        }

        /**
         * Update Load More button visibility based on 5-row rule
         * Grid:
         * - Mobile (<768px): 1 col -> 5 items
         * - Tablet (>=768px): 2 cols -> 10 items
         * - Desktop (>=1280px): 3 cols -> 15 items
         */
        function updateLoadMoreVisibility(countOverride = null) {
            const container = document.getElementById('load-more-container');
            if (!container) return;

            // Get visible card count if not provided
            let count = countOverride;
            if (count === null) {
                const cards = document.querySelectorAll('.event-card:not(.hidden)');
                count = cards.length;
            }

            // Determine columns based on window width
            const width = window.innerWidth;
            let cols = 1;
            if (width >= 1280) cols = 3;      // xl:grid-cols-3
            else if (width >= 768) cols = 2;  // md:grid-cols-2

            const limit = cols * 5; // 5 rows

            if (count > limit) {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }
    </script>
</body>

</html>