generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

enum UserRole {
  user
  admin
}

enum EventStatus {
  draft
  published
  cancelled
  completed
}

enum TicketTypeStatus {
  active
  sold_out
  hidden
}

enum OrderStatus {
  pending
  paid
  cancelled
  refunded
}

enum TicketStatus {
  valid
  used
  cancelled
}

// ==================== MODELS ====================

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    @map("password_hash")
  fullName     String    @map("full_name")
  avatarUrl    String?   @map("avatar_url")
  role         UserRole  @default(user)
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  // Extended profile fields
  dateOfBirth  DateTime? @map("date_of_birth")
  phoneNumber  String?   @map("phone_number")
  facebookUrl  String?   @map("facebook_url")
  gender       String?   // 'male', 'female', 'other'
  address      String?

  orders        Order[]
  tickets       Ticket[]
  notifications Notification[]

  @@map("users")
}

model Event {
  id                 String      @id @default(uuid())
  title              String
  slug               String      @unique
  description        String?     @db.Text
  content            String?     @db.Text
  location           String?
  startTime          DateTime?   @map("start_time")
  endTime            DateTime?   @map("end_time")
  bannerImage        String?     @map("banner_image")
  thumbnailImage     String?     @map("thumbnail_image")
  category           String?
  status             EventStatus @default(draft)
  isHot              Boolean     @default(false) @map("is_hot")
  maxTicketsPerUser  Int         @default(10) @map("max_tickets_per_user")
  createdAt          DateTime    @default(now()) @map("created_at")
  updatedAt          DateTime    @updatedAt @map("updated_at")

  ticketTypes TicketType[]
  tickets     Ticket[]
  banners     Banner[]
  rooms       Room[]

  @@map("events")
}

model TicketType {
  id            String           @id @default(uuid())
  eventId       String           @map("event_id")
  name          String
  description   String?          @db.Text
  price         Decimal          @db.Decimal(12, 2)
  originalPrice Decimal?         @map("original_price") @db.Decimal(12, 2)
  quantityTotal Int              @map("quantity_total")
  quantitySold  Int              @default(0) @map("quantity_sold")
  status        TicketTypeStatus @default(active)

  event   Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tickets Ticket[]

  @@map("ticket_types")
}

model Order {
  id                   String      @id @default(uuid())
  userId               String      @map("user_id")
  totalAmount          Decimal     @map("total_amount") @db.Decimal(12, 2)
  status               OrderStatus @default(pending)
  paymentMethod        String?     @map("payment_method")
  paymentTransactionId String?     @map("payment_transaction_id")
  createdAt            DateTime    @default(now()) @map("created_at")
  updatedAt            DateTime    @updatedAt @map("updated_at")

  user    User     @relation(fields: [userId], references: [id])
  tickets Ticket[]

  @@map("orders")
}

model Ticket {
  id              String       @id @default(uuid())
  orderId         String       @map("order_id")
  ticketTypeId    String       @map("ticket_type_id")
  userId          String       @map("user_id")
  eventId         String       @map("event_id")
  ticketCode      String       @unique @map("ticket_code")
  qrCode          String?      @map("qr_code") @db.Text
  status          TicketStatus @default(valid)
  usedAt          DateTime?    @map("used_at")
  priceAtPurchase Decimal      @map("price_at_purchase") @db.Decimal(12, 2)
  seatId          String?      @map("seat_id")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")

  order      Order      @relation(fields: [orderId], references: [id])
  ticketType TicketType @relation(fields: [ticketTypeId], references: [id])
  user       User       @relation(fields: [userId], references: [id])
  event      Event      @relation(fields: [eventId], references: [id])
  seat       Seat?      @relation(fields: [seatId], references: [id])

  @@map("tickets")
}

model Banner {
  id       Int     @id @default(autoincrement())
  title    String
  imageUrl String  @map("image_url")
  linkUrl  String? @map("link_url")
  eventId  String? @map("event_id")
  priority Int     @default(0)
  isActive Boolean @default(true) @map("is_active")
  isHomepage Boolean @default(false) @map("is_homepage")

  event Event? @relation(fields: [eventId], references: [id])

  @@map("banners")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  title     String
  message   String   @db.Text
  type      String   @default("system")
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model Room {
  id          String   @id @default(uuid())
  name        String
  rows        Int
  seatsPerRow Int
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  seats       Seat[]
  events      Event[]

  @@map("rooms")
}

model Seat {
  id        String   @id @default(uuid())
  roomId    String   @map("room_id")
  row       String
  number    Int
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)

  tickets   Ticket[]

  @@unique([roomId, row, number])
  @@map("seats")
}
